
function setCheckedStart(value) {
    var stars = document.getElementsByClassName('rating-star');
    for(var i = 0; i < 5; i++) {
        stars[i].children [0].className = 'star-img'
        stars[i].children [1].className = 'star-img d-none'
    }

    for(var i = 0; i < value; i++) {
        stars[i].children [0].className = 'star-img d-none'
        stars[i].children [1].className = 'star-img'
    }
}

function setUnCheckedStart(value) {
    var stars = document.getElementsByClassName('rating-star');
    var rating_value = document.getElementById('rating').value
    for(var i = rating_value; i < value; i++) {
        stars[i].children [0].className = 'star-img'
        stars[i].children [1].className = 'star-img d-none'
    }
}

function starOn(value) {
    var stars = document.getElementsByClassName('rating-star');
    for(var i = 0; i < value; i++) {
        stars[i].children [0].className = 'star-img d-none'
        stars[i].children [1].className = 'star-img'
    }
}

function setRating(value) {
    document.getElementById('rating').value = value
    setCheckedStart(value)
}

function loadRatings() {
    var offset = document.getElementById('offset_ratings').value;
    var course = document.getElementById('course_ratings').value;

    const xhttp = new XMLHttpRequest()
    xhttp.onload = function() {
        if(this.responseText.length == 0)
            document.getElementById('btn_load_ratings').style.display = 'none';
        else
            document.getElementById('container_ratings').innerHTML += this.responseText;
    }
    xhttp.open('GET', '../blocks/course_rating/endpoint.php?course='+course+'&offset='+offset);
    xhttp.send();

    document.getElementById('offset_ratings').value = parseInt(offset) + 5;
}

var stars = document.getElementsByClassName('rating-star');
stars.forEach(element => {
    element.addEventListener('mouseover', (event) =>{
        starOn(element.dataset.block_rating)
    })
    element.addEventListener('mouseout', (event) =>{
        setUnCheckedStart(element.dataset.block_rating)
    })
    element.addEventListener('click', (event)=> {
        setRating(element.dataset.block_rating);
    })
});

if(document.getElementById('edit_rating_button')) {
    document.getElementById('edit_rating_button').addEventListener('click', (event) => {
        document.getElementById('rating_message').style.display = 'none';
        document.getElementById('rating_form').style.display = 'block';
    });
    document.getElementById('cancel_rating_button').addEventListener('click', (event) => {
        document.getElementById('rating_message').style.display = 'flex';
        document.getElementById('rating_form').style.display = 'none';
    });
} 

(function() {
   // your page initialization code here
   // the DOM will be available here
    if(document.getElementById('rating'))
      setCheckedStart(document.getElementById('rating').value);

    if(document.getElementById('offset_ratings') && document.getElementById('course_ratings'))
        loadRatings();
})();


